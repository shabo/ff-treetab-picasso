# TST Color Tab Tree

Right-click any tab and apply a color (20-color palette) to **that tab and all of its descendants** in **Tree Style Tab's sidebar**.

This uses Tree Style Tab's external API to:

- compute the subtree (`get-light-tree`)
- apply a custom tab state (CSS class) to the subtree (`add-tab-state` / `remove-tab-state`)

## What You Get

ASCII view of the behavior:

```
Root A
|-- A1
|   |-- A1a
|   `-- A1b
`-- A2

Right-click A1  -> pick Blue (#1E88E5)

Root A
|-- [BLUE] A1
|   |-- [BLUE] A1a
|   `-- [BLUE] A1b
`-- A2
```

Emoji markers (optional):

```
Root A
|-- A1
|   |-- A1a
|   `-- A1b
`-- A2

Right-click A1 -> Color Tab Tree (TST) -> Emojis -> Pick Emoji... -> ðŸ˜€

Root A
|-- [BLUE][ðŸ˜€] A1
|   |-- [BLUE]    A1a
|   `-- [BLUE]    A1b
`-- A2
```

Notes:

- This colors tabs in the **Tree Style Tab sidebar** (TST renders tabs and can be styled via injected CSS). Firefox does not support per-tab coloring in the native horizontal tab strip.
- The menu is added to the normal Firefox tab context menu; Tree Style Tab typically mirrors those items into its own sidebar tab context menu.
- Emoji markers are shown **only on the clicked tab** (not its descendants).
- Use `Clear Emoji`, `Clear Color`, or `Clear Both` in the root menu.
- `ðŸ’£ Clear everything` clears all emoji+color markers from all tabs (and resets emoji Recent/Frequent history).
- The `Emojis` submenu opens a picker with **all emoji** (iPhone-ish categories + search) and also tracks `Recent` + `Frequently used` locally via extension storage.

## Requirements

- Firefox
- Tree Style Tab installed (ID: `treestyletab@piro.sakura.ne.jp`)
- In Tree Style Tab settings, enable external control (wording varies by version):
  - Tree Style Tab â†’ Settings â†’ allow/accept messages from other addons (external addons API)
- Node.js + npm (only for `make build` / `make run`)

## Install (Temporary, for development)

1. Open `about:debugging#/runtime/this-firefox`
2. Click **Load Temporary Add-on...**
3. Select `src/manifest.json`
4. Open a tab context menu:
   - Right-click a tab (either in the tab strip or in TST's sidebar)
   - Choose `Color Tab Tree (TST)`
   - Pick one of the 20 shades (`#FFFFFF` ... `#000000`)

## Build Artifact

This builds an unsigned ZIP artifact (Firefox accepts ZIP-as-XPI for temporary loading; for normal installation on stable Firefox you typically need signing via AMO).

```sh
make deps
make lint
make build
```

Output will be in `dist/` (generated by `web-ext build`).

## Publish To AMO (Firefox Add-ons Store)

There are two distribution modes on AMO:

- **Unlisted**: AMO signs it, you distribute the XPI yourself (good for personal/team use).
- **Listed**: appears on `addons.mozilla.org` search/browse and goes through full review.

### Option A: Upload via the AMO Developer Hub (simplest)

1. Create a developer account at `addons.mozilla.org` (Developer Hub).
2. Choose **Submit a New Add-on**.
3. Pick **Listed** (store) or **Unlisted** (self-distribute).
4. Upload the ZIP from `dist/` or upload the source directory package created by `web-ext build`.
5. Fill in listing details, permissions justification, and (if requested) privacy/data-collection disclosures.
6. Submit for review (listed). Once approved, AMO will sign and publish it.

### Option B: Sign from CLI (web-ext sign)

1. Create AMO API credentials (JWT issuer/secret) in the Developer Hub.
2. Export env vars:

```sh
export AMO_JWT_ISSUER="..."
export AMO_JWT_SECRET="..."
```

3. Sign:

```sh
make deps
make sign-unlisted
# or:
make sign-listed
```

The signed `.xpi` will be written under `dist/`.

## Run (with web-ext)

Foreground:

```sh
make deps
make run
```

Background:

```sh
make deps
make start
make stop
```
